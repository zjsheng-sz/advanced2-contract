# MyMemeToken 代币合约操作指南

## 概述

MyMemeToken 是一个基于 ERC-20 标准的代币合约，具有自动交易税、交易限制和流动性管理功能。本指南将详细介绍如何部署、配置和使用该代币合约。

## 一、合约部署

### 1.1 环境准备

**安装必要依赖：**
```bash
# 创建项目目录
mkdir my-meme-token
cd my-meme-token

# 初始化 npm 项目
npm init -y

# 安装 Hardhat 和依赖
npm install --save-dev hardhat
npm install @openzeppelin/contracts

# 初始化 Hardhat
npx hardhat init
```

### 1.2 部署脚本

创建部署脚本 `scripts/deploy.js`：

```javascript
const hre = require("hardhat");

async function main() {
  const [deployer] = await ethers.getSigners();
  
  console.log("部署账户:", deployer.address);
  console.log("账户余额:", (await deployer.provider.getBalance(deployer.address)).toString());

  // 获取合约工厂
  const MyMemeToken = await ethers.getContractFactory("MyMemeToken");
  
  // 配置参数
  const tokenName = "MyMemeToken";
  const tokenSymbol = "MMT";
  const totalSupply = 1000000; // 100万代币
  const uniswapRouter = "0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D"; // 以太坊主网 Uniswap V2 路由

  // 部署合约
  console.log("正在部署合约...");
  const token = await MyMemeToken.deploy(
    tokenName,
    tokenSymbol,
    totalSupply,
    uniswapRouter
  );

  await token.waitForDeployment();
  
  console.log("✅ 合约部署成功!");
  console.log("合约地址:", await token.getAddress());
  console.log("代币名称:", await token.name());
  console.log("代币符号:", await token.symbol());
  console.log("总供应量:", (await token.totalSupply()).toString());
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

### 1.3 执行部署

**测试网部署：**
```bash
# 部署到 Goerli 测试网
npx hardhat run scripts/deploy.js --network goerli

# 部署到 Sepolia 测试网  
npx hardhat run scripts/deploy.js --network sepolia
```

**主网部署：**
```bash
# 部署到以太坊主网
npx hardhat run scripts/deploy.js --network mainnet
```

## 二、初始配置

### 2.1 添加流动性（部署后必须执行）

部署完成后，需要添加初始流动性才能启用交易：

```javascript
// 添加流动性脚本 addLiquidity.js
const hre = require("hardhat");

async function main() {
  const [owner] = await ethers.getSigners();
  
  // 替换为你的合约地址
  const tokenAddress = "0xYourTokenAddress";
  const MyMemeToken = await ethers.getContractFactory("MyMemeToken");
  const token = MyMemeToken.attach(tokenAddress);
  
  // 配置流动性参数
  const tokenAmount = 500000 * 10 ** 18; // 50万代币
  const ethAmount = ethers.parseEther("5"); // 5 ETH
  
  // 授权合约操作代币
  await token.approve(tokenAddress, tokenAmount);
  
  // 添加流动性
  console.log("正在添加流动性...");
  const tx = await token.addLiquidity(tokenAmount, ethAmount, {
    value: ethAmount
  });
  
  await tx.wait();
  console.log("✅ 流动性添加成功!");
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

### 2.2 启用交易

流动性添加完成后，启用交易：

```javascript
// 启用交易脚本 enableTrading.js
const hre = require("hardhat");

async function main() {
  const [owner] = await ethers.getSigners();
  
  const tokenAddress = "0xYourTokenAddress";
  const MyMemeToken = await ethers.getContractFactory("MyMemeToken");
  const token = MyMemeToken.attach(tokenAddress);
  
  console.log("正在启用交易...");
  const tx = await token.enableTrading();
  await tx.wait();
  
  console.log("✅ 交易已启用!");
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

## 三、代币交易操作

### 3.1 普通用户转账

**基本转账：**
```javascript
// 转账给其他地址
const tx = await token.transfer("0xRecipientAddress", 1000 * 10 ** 18);
await tx.wait();
```

**转账注意事项：**
- **5% 交易税**：每笔交易扣除 5% 作为税费
- **税费分配**：80% 归税收接收地址，20% 销毁
- **单笔上限**：默认最大交易量为总供应量的 1%
- **每日限制**：普通用户每天最多 3 次转账

### 3.2 免税交易

**添加地址到免税名单：**
```javascript
// 仅合约所有者可调用
await token.setTaxExclusion("0xAddress", true);
```

**默认免税地址：**
- 合约所有者
- 税收接收地址
- 销毁地址
- 零地址

### 3.3 交易限制查询

**查询交易限制：**
```javascript
// 查询最大交易量
const maxAmount = await token.maxTransactionAmount();

// 查询每日转账次数
const dailyCount = await token.dailyTransferCount("0xUserAddress");
const maxDailyCount = await token.maxDailyTransferCount();

// 检查交易是否启用
const isTradingEnabled = await token.tradingEnabled();
```

## 四、流动性管理

### 4.1 普通用户添加流动性

普通用户可以通过 Uniswap 界面添加流动性：

1. **访问 Uniswap**：https://app.uniswap.org/
2. **连接钱包**：选择你的钱包（MetaMask 等）
3. **选择 Pool**：点击 "Pool" → "Add Liquidity"
4. **选择代币对**：选择 MMT/ETH 交易对
5. **输入数量**：输入要添加的代币和 ETH 数量
6. **确认交易**：授权并确认交易

### 4.2 合约所有者流动性管理

**添加流动性：**
```javascript
// 使用合约资金添加流动性
await token.addLiquidity(
  100000 * 10 ** 18, // 10万代币
  ethers.parseEther("1"), // 1 ETH
  { value: ethers.parseEther("1") }
);
```

**移除流动性：**
```javascript
// 获取 LP 代币余额
const lpTokenAddress = await token.uniswapV2Pair();
const lpToken = await ethers.getContractAt("IERC20", lpTokenAddress);
const lpBalance = await lpToken.balanceOf(owner.address);

// 移除流动性
if (lpBalance > 0) {
  await token.removeLiquidity(lpBalance);
}
```

## 五、管理功能

### 5.1 交易限制调整

**调整交易限制：**
```javascript
// 设置新的交易限制
await token.setTransactionLimits(
  500000 * 10 ** 18, // 新的最大交易量
  5                  // 新的每日转账次数限制
);
```

### 5.2 应急功能

**提取意外发送的 ETH：**
```javascript
// 仅合约所有者可调用
await token.withdrawStuckETH();
```

## 六、安全注意事项

### 6.1 部署前检查

1. **税收地址**：确保 `TAX_RECEIVER` 地址正确配置
2. **流动性锁定**：考虑使用 Unicrypt 等工具锁定流动性
3. **滑点设置**：实际部署时设置合理的滑点容差

### 6.2 安全最佳实践

1. **多签钱包**：使用多签钱包管理合约所有者权限
2. **时间锁定**：考虑添加交易启用时间锁定机制
3. **社区治理**：成熟后可转为 DAO 治理模式
4. **第三方审计**：建议进行第三方安全审计

### 6.3 风险提示

- **合约所有者权限**：所有者拥有较大权限，需谨慎使用
- **流动性风险**：流动性不足可能导致价格剧烈波动
- **监管合规**：确保符合当地法律法规要求

## 七、常见问题

### Q: 为什么交易被拒绝？
A: 可能原因：
- 交易未启用（`tradingEnabled` = false）
- 超过单笔交易上限
- 超过每日转账次数限制
- 合约余额不足

### Q: 如何查询税收信息？
A: 通过事件日志查询：
```javascript
const filter = token.filters.TaxCollected();
const events = await token.queryFilter(filter);
```

### Q: 普通用户如何参与流动性提供？
A: 通过 Uniswap 界面操作，无需调用合约函数。

## 八、技术支持

如有技术问题，可参考：
- OpenZeppelin 文档：https://docs.openzeppelin.com/
- Uniswap V2 文档：https://docs.uniswap.org/
- 以太坊官方文档：https://ethereum.org/developers/

---

*本指南仅供参考，实际部署前请进行充分测试和风险评估。*

**版本：** v1.0  
**最后更新：** 2024-01-24